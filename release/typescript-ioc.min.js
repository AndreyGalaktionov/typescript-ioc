"use strict";function Singleton(t){IoCContainer.bind(t).scope(Scope.Singleton)}function Scoped(t){return function(n){IoCContainer.bind(n).scope(t)}}function Provided(t){return function(n){IoCContainer.bind(n).provider(t)}}function Provides(t){return function(n){IoCContainer.bind(t).to(n)}}function AutoWired(t){var n,e=Reflect.getOwnMetadata("params_inject",t)||[];if(e.length>0){e.reverse();var o=Reflect.getMetadata("design:paramtypes",t);n=InjectorHanlder.decorateConstructor(function(){for(var n=[],r=0;r<arguments.length;r++)n[r-0]=arguments[r];IoCContainer.assertInstantiable(t);for(var i=n?n.concat():new Array,c=0,a=e;c<a.length;c++){var s=a[c];s>=i.length&&i.push(IoCContainer.get(o[s]))}t.apply(this,i),IoCContainer.applyInjections(this,t)},t)}else n=InjectorHanlder.decorateConstructor(function(){for(var n=[],e=0;e<arguments.length;e++)n[e-0]=arguments[e];IoCContainer.assertInstantiable(t),t.apply(this,n),IoCContainer.applyInjections(this,t)},t);var r=IoCContainer.bind(t);return r.toConstructor(n),n}function Inject(){for(var t=[],n=0;n<arguments.length;n++)t[n-0]=arguments[n];if(2==t.length)return InjectPropertyDecorator.apply(this,t);if(3==t.length&&"number"==typeof t[2])return InjectParamDecorator.apply(this,t);throw new Error("Invalid @Inject Decorator declaration.")}function InjectPropertyDecorator(t,n){var e=Reflect.getMetadata("design:type",t,n);IoCContainer.addPropertyInjector(t.constructor,n,e)}function InjectParamDecorator(t,n,e){if(!n){var o=Reflect.getOwnMetadata("params_inject",t,n)||[];o.push(e),Reflect.defineMetadata("params_inject",o,t,n)}}function checkType(t){if(!t)throw new TypeError("Invalid type requested to IoC container. Type is not defined.")}var __extends=this&&this.__extends||function(t,n){function e(){this.constructor=t}for(var o in n)n.hasOwnProperty(o)&&(t[o]=n[o]);t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)};require("reflect-metadata"),exports.Singleton=Singleton,exports.Scoped=Scoped,exports.Provided=Provided,exports.Provides=Provides,exports.AutoWired=AutoWired,exports.Inject=Inject;var Map=function(){function t(){}return t.prototype.put=function(t,n){this[t]=n},t.prototype.get=function(t){return this[t]},t.prototype.remove=function(t){delete this[t]},t}(),Container=function(){function t(){}return t.bind=function(t){return IoCContainer.isBound(t)?IoCContainer.bind(t):(AutoWired(t),IoCContainer.bind(t).to(t))},t.get=function(t){return IoCContainer.get(t)},t}();exports.Container=Container;var IoCContainer=function(){function t(){}return t.isBound=function(n){checkType(n);var e=InjectorHanlder.getConstructorFromType(n),o=t.bindings.get(e);return!!o},t.bind=function(n){checkType(n);var e=InjectorHanlder.getConstructorFromType(n),o=t.bindings.get(e);return o||(o=new ConfigImpl(e),t.bindings.put(e,o)),o},t.get=function(n){var e=t.bind(n);return e.iocprovider||e.to(e.source),e.getInstance()},t.applyInjections=function(t,n){if(n){var e=InjectorHanlder.getInjectorFromType(n,!1);e.forEach(function(n){n(t)})}else{var e=InjectorHanlder.getInjectorFromInstance(t);e.forEach(function(n){n(t)})}},t.addPropertyInjector=function(n,e,o){var r=InjectorHanlder.getInjectorFromType(n,!1);r.push(function(n){t.injectProperty(n,e,o)})},t.injectProperty=function(n,e,o){n[e]=t.get(o)},t.assertInstantiable=function(t){if(t.__block_Instantiation)throw new TypeError("Can not instantiate Singleton class. Ask Container for it, using Container.get")},t.bindings=new Map,t}(),ConfigImpl=function(){function t(t){this.source=t}return t.prototype.to=function(t){checkType(t);var n=InjectorHanlder.getConstructorFromType(t);if(this.source===n){var e=this;this.iocprovider={get:function(){return e.decoratedConstructor?new e.decoratedConstructor:new t}}}else this.iocprovider={get:function(){return IoCContainer.get(t)}};return this.iocscope&&this.iocscope.reset(this.source),this},t.prototype.provider=function(t){return this.iocprovider=t,this.iocscope&&this.iocscope.reset(this.source),this},t.prototype.scope=function(t){return this.iocscope=t,t===Scope.Singleton?(this.source.__block_Instantiation=!0,t.reset(this.source)):this.source.__block_Instantiation&&delete this.source.__block_Instantiation,this},t.prototype.toConstructor=function(t){return this.decoratedConstructor=t,this},t.prototype.getInstance=function(){return this.iocscope||this.scope(Scope.Local),this.iocscope.resolve(this.iocprovider,this.source)},t}(),Scope=function(){function t(){}return t.prototype.reset=function(t){},t}();exports.Scope=Scope;var LocalScope=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.prototype.resolve=function(t,n){return t.get()},n}(Scope);Scope.Local=new LocalScope;var SingletonScope=function(t){function n(){t.apply(this,arguments)}return __extends(n,t),n.prototype.resolve=function(t,e){var o=n.instances.get(e);return o||(e.__block_Instantiation=!1,o=t.get(),e.__block_Instantiation=!0,n.instances.put(e,o)),o},n.prototype.reset=function(t){n.instances.remove(InjectorHanlder.getConstructorFromType(t))},n.instances=new Map,n}(Scope);Scope.Singleton=new SingletonScope;var InjectorHanlder=function(){function t(){}return t.decorateConstructor=function(t,n){function e(){this.constructor=t}for(var o in n)n.hasOwnProperty(o)&&!t.hasOwnProperty(o)&&(t[o]=n[o]);return t.__parent=n,t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e),t},t.getConstructorFromType=function(t){var n=t;if(n.name)return n;for(;n=n.__parent;)if(n.name)return n;throw TypeError("Can not identify the base Type for requested target")},t.getConstructorFromInstance=function(n){return t.getConstructorFromType(n.constructor)},t.getInjectorFromType=function(n,e){var o=t.getConstructorFromType(n);t.typeInjections[o]||(t.typeInjections[o]=new Array);var r=t.typeInjections[o];if(e){var i=o.__parent;i&&(r=t.getInjectorFromType(i,!0).concat(r))}return r},t.getInjectorFromInstance=function(n){var e=t.getConstructorFromInstance(n);return t.getInjectorFromType(e,!0)},t.typeInjections=new Map,t}();